# Grafana configuration for Home Assistant Add-on
# Fixed permissions for dashboard access

[paths]
data = /data/grafana/data
logs = /data/grafana/logs
plugins = /data/grafana/plugins
provisioning = /etc/grafana/provisioning
temp_data_lifetime = 24h

[server]
http_port = 3001
domain = localhost
root_url = %(protocol)s://%(domain)s:%(http_port)s/
serve_from_sub_path = false
enable_gzip = true
router_logging = true
static_root_path = /usr/share/grafana/public

[rendering]
server_max_concurrent_renderings = 0
callback_timeout = 30
concurrent_render_limit = 1
rendering_mode = disabled

[security]
admin_user = admin
admin_password = admin
allow_embedding = true
disable_initial_admin_creation = false
cookie_samesite = lax
strict_transport_security = false
cookie_secure = false
# Allow iframe embedding from any origin for Home Assistant
allow_embedding = true
cookie_samesite = none

[auth.anonymous]
enabled = true
# Change from Viewer to Admin to fix permissions
org_role = Admin
# Alternative: use Editor if Admin is too permissive
# org_role = Editor

[auth]
disable_login_form = false
disable_signout_menu = true
login_maximum_inactive_lifetime_duration = 7d
login_maximum_lifetime_duration = 30d

[users]
# Allow viewers to edit dashboards
auto_assign_org_role = Admin
viewers_can_edit = true
editors_can_admin = true
# Set default org role to Admin for new users
default_theme = light

[database]
type = sqlite3
path = /data/grafana/grafana.db
wal = true
cache_mode = shared
sqlite_vfs = unix-excl

[analytics]
reporting_enabled = false
check_for_updates = false
feedback_links_enabled = false

[dashboards]
# Allow dashboard modifications
versions_to_keep = 1
min_refresh_interval = 100ms
# Set default home dashboard permissions
default_home_dashboard_path = /etc/grafana/provisioning/dashboards/solar_dashboard.json

[unified_alerting]
enabled = false

[alerting]
enabled = false
concurrent_render_limit = 1
evaluation_timeout_seconds = 30

[unified_alerting.state_history.annotations]
enabled = false
max_annotations_to_keep = 100
max_age = 0

[metrics]
enabled = false

[log]
mode = console
level = warn
filters = rendering:error,plugin.manager:error,plugins.registration:error,plugins.initialization:error,provisioning.plugins:error,provisioning.alerting:error

[explore]
enabled = false

[help]
enabled = false

[profile]
enabled = false

[quota]
enabled = false

[annotations]
enabled = false

[panels]
disable_sanitize_html = true
enable_alpha = false

[plugins]
enable_alpha = false
app_tls_skip_verify_insecure = false
plugin_admin_enabled = false
plugin_catalog_url = 
scan_for_plugins = false
marketplace_url = 
allow_loading_unsigned_plugins = 
plugin_admin_external_manage_enabled = false

[live]
enabled = false

[feature_toggles]
enable = publicDashboards timezoneSelection

[expressions]
enabled = false

[external_image_storage]
provider = 

[remote_cache]
type = database

[dataproxy]
timeout = 30
keep_alive_seconds = 30
expect_continue_timeout_seconds = 1
idle_conn_timeout_seconds = 90
response_limit = 50000000
max_connections = 20
max_idle_connections = 5

[auth.proxy]
enabled = false

[unified_alerting.screenshots]
capture = false

[tracing.opentelemetry]
enabled = false

[memory]
total_memory_limit_mb = 240
limit_percentage = 80
limit_refresh_rate = 1m
gc_interval = 5m
