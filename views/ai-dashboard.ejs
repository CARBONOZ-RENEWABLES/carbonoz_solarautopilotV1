<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Dashboard - CARBONOZ SolarAutopilot</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
     <link rel="stylesheet" href="<%= ingress_path %>/css/ai-dashboard.css">

</head>
<body>
  <!-- Add hamburger menu button -->
    <button class="mobile-toggle" id="mobileToggle">
        <span></span>
        <span></span>
        <span></span>
    </button>
    <div class="container">
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-spinner"></div>
        </div>
        <div id="pageContent"> </div>

        <%- include('partials/sidebar') %>
          
    <div class="main-content">
    <div class="dashboard-container">
        <!-- Header -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h2>
                            <i class="fas fa-robot me-2"></i>
                            AI Dashboard
                        </h2>
                        <div class="status-display">
                            <span class="status-indicator status-online"></span>
                            <span>Live Data</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Metrics Row -->
        <div class="row">
            <div class="col-3">
                <div class="metric-card battery">
                    <div class="metric-value" id="batterySOC">--</div>
                    <div class="metric-label">
                        <i class="fas fa-battery-three-quarters me-1"></i>
                        Battery SOC
                    </div>
                </div>
            </div>
            <div class="col-3">
                <div class="metric-card solar">
                    <div class="metric-value" id="pvPower">--</div>
                    <div class="metric-label">
                        <i class="fas fa-sun me-1"></i>
                        Solar Power
                    </div>
                </div>
            </div>
            <div class="col-3">
                <div class="metric-card grid">
                    <div class="metric-value" id="gridPower">--</div>
                    <div class="metric-label">
                        <i class="fas fa-plug me-1"></i>
                        Grid Power
                    </div>
                </div>
            </div>
            <div class="col-3">
                <div class="metric-card load">
                    <div class="metric-value" id="loadPower">--</div>
                    <div class="metric-label">
                        <i class="fas fa-home me-1"></i>
                        Load Power
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Status and Price Info Row -->
        <div class="row">
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-brain me-2"></i>
                            AI Charging Engine Status
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="aiStatus" class="ai-status">
                            <div class="ai-status-content">
                                <h6>Engine Status</h6>
                                <p id="aiStatusText">Loading...</p>
                            </div>
                            <div class="ai-status-icon">
                                <button id="aiToggleBtn" class="btn" onclick="toggleAIEngine()" disabled>
                                    <i class="fas fa-power-off"></i>
                                </button>
                                <i class="fas fa-robot fa-2x"></i>
                            </div>
                        </div>
                        <div class="stats-row">
                            <div class="stat-item">
                                <div class="stat-label">Last Decision:</div>
                                <div class="stat-value" id="lastDecision">--</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Decision Count:</div>
                                <div class="stat-value" id="decisionCount">--</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-euro-sign me-2"></i>
                            Tibber Price Info
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="stats-row">
                            <div class="stat-item">
                                <div class="stat-label">Current Price:</div>
                                <div class="price-display">
                                    <span id="currentPrice" class="h5 mb-0">--</span>
                                    <span id="priceLevel" class="price-indicator">--</span>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Average Price:</div>
                                <div id="averagePrice" class="h5 mb-0">--</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="stat-label">Price Status:</div>
                            <div id="priceStatus" class="fw-bold">--</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row">
            <div class="col-8">
                <div class="card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-chart-line me-2"></i>
                            Real-Time System Data
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="systemChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-chart-pie me-2"></i>
                            Energy Distribution
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="energyChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Price Charts Row -->
        <div class="row">
            <div class="col-8">
                <div class="card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-euro-sign me-2"></i>
                            24-Hour Price Forecast
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="priceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-chart-bar me-2"></i>
                            Price Levels
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="priceLevelChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Decisions and Commands Row -->
        <div class="row">
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-lightbulb me-2"></i>
                            Recent AI Decisions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="aiDecisions" class="command-log">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin me-2"></i>
                                Loading AI decisions...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-6">
                <div class="card">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-terminal me-2"></i>
                            Commands Sent
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="commandLog" class="command-log">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin me-2"></i>
                                Loading command history...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>
    </div>

    <script>
        // Global variables
        let systemChart, energyChart, priceChart, priceLevelChart;
        let systemData = {
            labels: [],
            battery: [],
            solar: [],
            grid: [],
            load: []
        };
        let priceData = {
            labels: [],
            prices: [],
            levels: []
        };
        let refreshInterval;

        // Toggle mobile menu
        function toggleMenu() {
            const menu = document.getElementById('navbarMenu');
            menu.classList.toggle('active');
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadDashboardData();
            startAutoRefresh();
        });

        // Initialize charts
        function initializeCharts() {
            const systemCtx = document.getElementById('systemChart').getContext('2d');
            systemChart = new Chart(systemCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Battery SOC (%)',
                            data: [],
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Solar Power (W)',
                            data: [],
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Grid Power (W)',
                            data: [],
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: 'Load Power (W)',
                            data: [],
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Battery SOC (%)'
                            },
                            min: 0,
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Power (W)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'System Performance Over Time'
                        }
                    }
                }
            });

            const energyCtx = document.getElementById('energyChart').getContext('2d');
            energyChart = new Chart(energyCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Solar', 'Grid', 'Battery'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            '#f39c12',
                            '#3498db',
                            '#27ae60'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        },
                        title: {
                            display: true,
                            text: 'Current Energy Sources'
                        }
                    }
                }
            });

            // Initialize price chart
            const priceCtx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Price (SEK/kWh)',
                        data: [],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Time'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Price (SEK/kWh)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: '24-Hour Price Forecast'
                        }
                    }
                }
            });

            // Initialize price level chart
            const priceLevelCtx = document.getElementById('priceLevelChart').getContext('2d');
            priceLevelChart = new Chart(priceLevelCtx, {
                type: 'bar',
                data: {
                    labels: ['Very Low', 'Low', 'Normal', 'High', 'Very High'],
                    datasets: [{
                        label: 'Hours',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#27ae60',
                            '#2ecc71',
                            '#f39c12',
                            '#e67e22',
                            '#e74c3c'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Hours'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Price Level Distribution'
                        }
                    }
                }
            });
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                await loadSystemState();
                await loadAIStatus();
                await loadTibberData();
                await loadPriceData();
                await loadAIDecisions();
                await loadCommandHistory();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Load system state
        async function loadSystemState() {
            try {
                const response = await fetch('/api/system-state');
                const data = await response.json();
                
                if (data.current_state) {
                    const state = data.current_state;
                    updateMetricCard('batterySOC', state.battery_soc, '%');
                    updateMetricCard('pvPower', state.pv_power, 'W');
                    updateMetricCard('gridPower', state.grid_power, 'W');
                    updateMetricCard('loadPower', state.load, 'W');
                    updateSystemChart(state);
                    updateEnergyChart(state);
                }
            } catch (error) {
                console.error('Error loading system state:', error);
            }
        }

        // Load AI status
        async function loadAIStatus() {
            try {
                const response = await fetch('/api/ai/status');
                const data = await response.json();
                
                const statusElement = document.getElementById('aiStatus');
                const statusTextElement = document.getElementById('aiStatusText');
                const toggleBtn = document.getElementById('aiToggleBtn');
                
                if (data.success) {
                    const isActive = data.learner_mode && data.ai.enabled && data.ai.running;
                    
                    if (isActive) {
                        statusElement.className = 'ai-status active';
                        statusTextElement.textContent = 'AI Engine Active - Making Smart Decisions';
                        toggleBtn.innerHTML = '<i class="fas fa-stop"></i>';
                    } else {
                        statusElement.className = 'ai-status inactive';
                        statusTextElement.textContent = data.learner_mode ? 'AI Engine Ready - Click to Start' : 'Learner Mode Required';
                        toggleBtn.innerHTML = '<i class="fas fa-play"></i>';
                    }
                    
                    toggleBtn.disabled = !data.learner_mode;
                    
                    if (data.ai.lastDecision) {
                        document.getElementById('lastDecision').textContent = data.ai.lastDecision.decision || '--';
                    }
                    
                    if (data.ai.decisionCount !== undefined) {
                        document.getElementById('decisionCount').textContent = data.ai.decisionCount;
                    }
                }
            } catch (error) {
                console.error('Error loading AI status:', error);
            }
        }

        // Load Tibber data
        async function loadTibberData() {
            try {
                const response = await fetch('/api/tibber/current');
                const data = await response.json();
                
                if (data.success && data.data) {
                    const tibberData = data.data;
                    
                    if (tibberData.currentPrice) {
                        document.getElementById('currentPrice').textContent = 
                            `${tibberData.currentPrice.total.toFixed(2)} ${tibberData.currentPrice.currency}`;
                        
                        const levelElement = document.getElementById('priceLevel');
                        levelElement.textContent = tibberData.currentPrice.level || 'NORMAL';
                        levelElement.className = `price-indicator price-${(tibberData.currentPrice.level || 'normal').toLowerCase().replace('_', '-')}`;
                    }
                    
                    if (tibberData.config && tibberData.config.enabled) {
                        document.getElementById('priceStatus').textContent = 'Connected';
                        
                        if (tibberData.forecast && tibberData.forecast.length > 0) {
                            const avgPrice = tibberData.forecast.reduce((sum, p) => sum + p.total, 0) / tibberData.forecast.length;
                            document.getElementById('averagePrice').textContent = 
                                `${avgPrice.toFixed(2)} ${tibberData.currentPrice?.currency || 'SEK'}`;
                        }
                    } else {
                        document.getElementById('priceStatus').textContent = 'Not configured';
                    }
                } else {
                    document.getElementById('currentPrice').textContent = '--';
                    document.getElementById('averagePrice').textContent = '--';
                    document.getElementById('priceLevel').textContent = '--';
                    document.getElementById('priceStatus').textContent = 'Service unavailable';
                }
            } catch (error) {
                console.error('Error loading Tibber data:', error);
            }
        }

        // Load price data for charts
        async function loadPriceData() {
            try {
                const response = await fetch('/api/tibber/current');
                const data = await response.json();
                
                if (data.success && data.data && data.data.forecast && data.data.forecast.length > 0) {
                    updatePriceChart(data.data.forecast);
                    updatePriceLevelChart(data.data.forecast);
                } else {
                    // Show no data message in charts
                    showNoPriceData();
                }
            } catch (error) {
                console.error('Error loading price data:', error);
                showNoPriceData();
            }
        }

        // Load AI decisions
        async function loadAIDecisions() {
            try {
                const response = await fetch('/api/ai/decisions?limit=10');
                const data = await response.json();
                const decisionsContainer = document.getElementById('aiDecisions');
                
                if (data.success && data.decisions && data.decisions.length > 0) {
                    decisionsContainer.innerHTML = data.decisions.map(decision => `
                        <div class="decision-card">
                            <div class="decision-timestamp">
                                ${formatTimestamp(decision.timestamp)}
                            </div>
                            <div class="decision-action">
                                <i class="fas fa-lightbulb me-1"></i>
                                ${decision.decision}
                            </div>
                            <div class="decision-reasons">
                                ${decision.reasons ? decision.reasons.map(reason => `• ${reason}`).join('<br>') : 'No reasons provided'}
                            </div>
                        </div>
                    `).join('');
                } else {
                    decisionsContainer.innerHTML = 
                        '<div class="text-center text-muted">No AI decisions available yet</div>';
                }
            } catch (error) {
                console.error('Error loading AI decisions:', error);
            }
        }

        // Load command history
        async function loadCommandHistory() {
            try {
                const response = await fetch('/api/ai/commands?limit=15');
                const data = await response.json();
                const commandContainer = document.getElementById('commandLog');
                
                if (data.success && data.commands && data.commands.length > 0) {
                    commandContainer.innerHTML = data.commands.map(command => `
                        <div class="command-item ${command.success ? 'success' : 'error'}">
                            <div class="command-header">
                                <div>
                                    <i class="fas ${command.success ? 'fa-check-circle' : 'fa-times-circle'} me-1"></i>
                                    <strong>${command.topic}</strong> = ${command.value}
                                    <div class="command-details">
                                        Source: ${command.source} | Status: ${command.success ? 'Success' : 'Failed'}
                                    </div>
                                </div>
                                <small class="text-muted command-timestamp">
                                    ${formatTimestamp(command.timestamp)}
                                </small>
                            </div>
                        </div>
                    `).join('');
                } else {
                    commandContainer.innerHTML = 
                        '<div class="text-center text-muted">No AI commands sent yet</div>';
                }
            } catch (error) {
                console.error('Error loading command history:', error);
                const commandContainer = document.getElementById('commandLog');
                commandContainer.innerHTML = 
                    '<div class="text-center text-muted">Error loading commands</div>';
            }
        }

        // Update metric card
        function updateMetricCard(elementId, value, unit) {
            const element = document.getElementById(elementId);
            if (element && value !== null && value !== undefined) {
                element.textContent = `${Math.round(value)}${unit}`;
            } else {
                element.textContent = '--';
            }
        }

        // Update system chart
        function updateSystemChart(state) {
            const now = new Date();
            const timeLabel = now.toLocaleTimeString();
            
            if (systemData.labels.length >= 20) {
                systemData.labels.shift();
                systemData.battery.shift();
                systemData.solar.shift();
                systemData.grid.shift();
                systemData.load.shift();
            }
            
            systemData.labels.push(timeLabel);
            systemData.battery.push(state.battery_soc || 0);
            systemData.solar.push(state.pv_power || 0);
            systemData.grid.push(state.grid_power || 0);
            systemData.load.push(state.load || 0);
            
            systemChart.data.labels = systemData.labels;
            systemChart.data.datasets[0].data = systemData.battery;
            systemChart.data.datasets[1].data = systemData.solar;
            systemChart.data.datasets[2].data = systemData.grid;
            systemChart.data.datasets[3].data = systemData.load;
            
            systemChart.update('none');
        }

        // Update energy chart
        function updateEnergyChart(state) {
            const solar = Math.max(0, state.pv_power || 0);
            const grid = Math.max(0, Math.abs(state.grid_power || 0));
            const battery = Math.max(0, Math.abs(state.battery_power || 0));
            
            if (solar > 0 || grid > 0 || battery > 0) {
                energyChart.data.datasets[0].data = [solar, grid, battery];
                energyChart.update('none');
            }
        }

        // Update price chart
        function updatePriceChart(forecast) {
            const labels = [];
            const prices = [];
            
            forecast.forEach(item => {
                const date = new Date(item.startsAt);
                labels.push(date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
                prices.push(item.total);
            });
            
            priceChart.data.labels = labels;
            priceChart.data.datasets[0].data = prices;
            priceChart.update();
        }

        // Update price level chart
        function updatePriceLevelChart(forecast) {
            const levelCounts = {
                'VERY_CHEAP': 0,
                'CHEAP': 0,
                'NORMAL': 0,
                'EXPENSIVE': 0,
                'VERY_EXPENSIVE': 0
            };
            
            forecast.forEach(item => {
                const level = item.level || 'NORMAL';
                if (levelCounts.hasOwnProperty(level)) {
                    levelCounts[level]++;
                }
            });
            
            priceLevelChart.data.datasets[0].data = [
                levelCounts['VERY_CHEAP'],
                levelCounts['CHEAP'],
                levelCounts['NORMAL'],
                levelCounts['EXPENSIVE'],
                levelCounts['VERY_EXPENSIVE']
            ];
            priceLevelChart.update();
        }

        // Show no price data message
        function showNoPriceData() {
            priceChart.data.labels = ['No Data'];
            priceChart.data.datasets[0].data = [0];
            priceChart.update();
            
            priceLevelChart.data.datasets[0].data = [0, 0, 0, 0, 0];
            priceLevelChart.update();
        }

        // Format timestamp
        function formatTimestamp(timestamp) {
            return new Date(timestamp).toLocaleString();
        }

        // Refresh dashboard
        function refreshDashboard() {
            const refreshBtn = document.querySelector('.refresh-btn');
            refreshBtn.classList.add('spinning');
            
            loadDashboardData().finally(() => {
                setTimeout(() => {
                    refreshBtn.classList.remove('spinning');
                }, 1000);
            });
        }

        // Start auto refresh
        function startAutoRefresh() {
            refreshInterval = setInterval(loadDashboardData, 30000);
        }

        // Toggle AI Engine
        async function toggleAIEngine() {
            const toggleBtn = document.getElementById('aiToggleBtn');
            const originalContent = toggleBtn.innerHTML;
            
            try {
                toggleBtn.disabled = true;
                toggleBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                
                const response = await fetch('/api/ai/toggle', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    await loadAIStatus();
                    showNotification(data.message, 'success');
                } else {
                    throw new Error(data.error || 'Failed to toggle AI engine');
                }
            } catch (error) {
                console.error('Error toggling AI engine:', error);
                showNotification('Failed to toggle AI engine: ' + error.message, 'error');
                toggleBtn.innerHTML = originalContent;
                toggleBtn.disabled = false;
            }
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                padding: 15px 20px;
                background: ${type === 'success' ? '#27ae60' : '#e74c3c'};
                color: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease;
            `;
            notification.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; margin-left: 15px;">×</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>

<script src="<%= ingress_path %>/js/loading.js"></script>
<script src="<%= ingress_path %>/js/dark-mode.js"></script>
<script src="<%= ingress_path %>/js/mobile.js"></script>
</body>
</html>